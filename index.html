<!DOCTYPE html>
<html lang="pt-br">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <link rel="stylesheet" href="styles.css?v=1.1">
Â  Â  <title>CondomÃ­nio T Lacerda - Login</title>

Â  Â  <script type="module">
Â  Â  Â  Â  // ==================== ðŸ”¥ INÃCIO FIREBASE ðŸ”¥ ====================
Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
Â  Â  Â  Â  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-analytics.js";
Â  Â  Â  Â  import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";
Â  Â  Â  Â  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";
Â  Â  Â  Â  import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";

Â  Â  Â  Â  import { app } from './firebase.js';

Â  Â  Â  Â  const forgotPasswordLink = document.getElementById('forgotPassword');
Â  Â  Â  Â  const forgotPasswordSection = document.getElementById('forgotPasswordSection');
Â  Â  Â  Â  const forgotPasswordForm = document.getElementById('forgotPasswordForm');
Â  Â  Â  Â  const mensagemForgotPassword = document.getElementById('mensagemForgotPassword');
Â  Â  Â  Â  const mostrarLoginFromForgotLink = document.getElementById('mostrarLoginFromForgot');
Â  Â  Â  Â  const loginSection = document.getElementById('login');
Â  Â  Â  Â  const cadastroSection = document.getElementById('cadastro');
Â  Â  Â  Â  const mostrarCadastroLink = document.getElementById('mostrarCadastro');
Â  Â  Â  Â  const mostrarLoginLink = document.getElementById('mostrarLogin');

Â  Â  Â  Â  if (forgotPasswordLink) {
Â  Â  Â  Â  Â  Â  forgotPasswordLink.addEventListener('click', function(event) {
Â  Â  Â  Â  Â  Â  Â  Â  event.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  loginSection.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  forgotPasswordSection.style.display = 'block';
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  if (mostrarLoginFromForgotLink) {
Â  Â  Â  Â  Â  Â  mostrarLoginFromForgotLink.addEventListener('click', function(event) {
Â  Â  Â  Â  Â  Â  Â  Â  event.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  forgotPasswordSection.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  loginSection.style.display = 'block';
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  if (forgotPasswordForm) {
Â  Â  Â  Â  Â  Â  forgotPasswordForm.addEventListener('submit', function(event) {
Â  Â  Â  Â  Â  Â  Â  Â  event.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  const emailForgotPassword = document.getElementById('emailForgotPassword').value;
Â  Â  Â  Â  Â  Â  Â  Â  const auth = getAuth();

Â  Â  Â  Â  Â  Â  Â  Â  sendPasswordResetEmail(auth, emailForgotPassword)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mensagemForgotPassword.textContent = 'Um link para redefinir sua senha foi enviado para o seu e-mail.';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .catch((error) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const errorCode = error.code;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const errorMessage = error.message;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mensagemForgotPassword.textContent = 'Erro ao enviar o e-mail de recuperaÃ§Ã£o: ' + errorMessage;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Erro ao enviar e-mail de recuperaÃ§Ã£o:', errorCode, errorMessage);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // Initialize Firebase
Â  Â  Â  Â  const analytics = getAnalytics(app);
Â  Â  Â  Â  const db = getDatabase(app);
Â  Â  Â  Â  const auth = getAuth(app);
Â  Â  Â  Â  const firestore = getFirestore(app);

Â  Â  Â  Â  if (mostrarCadastroLink) {
Â  Â  Â  Â  Â  Â  mostrarCadastroLink.addEventListener('click', function(event) {
Â  Â  Â  Â  Â  Â  Â  Â  event.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  loginSection.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  cadastroSection.style.display = 'block';
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  if (mostrarLoginLink) {
Â  Â  Â  Â  Â  Â  mostrarLoginLink.addEventListener('click', function(event) {
Â  Â  Â  Â  Â  Â  Â  Â  event.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  cadastroSection.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  loginSection.style.display = 'block';
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  const formularioLogin = document.getElementById('formularioLogin');
Â  Â  Â  Â  if (formularioLogin) {
Â  Â  Â  Â  Â  Â  formularioLogin.addEventListener('submit', async function(event) {
Â  Â  Â  Â  Â  Â  Â  Â  event.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  const emailLogin = document.getElementById('emailLogin').value;
Â  Â  Â  Â  Â  Â  Â  Â  const senhaLogin = document.getElementById('senhaLogin').value;
Â  Â  Â  Â  Â  Â  Â  Â  const mensagemLogin = document.getElementById('mensagemLogin');

Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userCredential = await signInWithEmailAndPassword(auth, emailLogin, senhaLogin);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const user = userCredential.user;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("UsuÃ¡rio logado com sucesso:", user.uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const pendingRef = ref(db, 'pendingApprovals/' + user.uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const snapshot = await get(pendingRef);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (snapshot.exists()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mensagemLogin.textContent = 'Seu acesso ainda estÃ¡ pendente de aprovaÃ§Ã£o. Por favor, aguarde.';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mensagemLogin.textContent = 'Login realizado com sucesso!';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userDetailsRef = ref(db, 'userApartments/' + user.uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userSnapshot = await get(userDetailsRef);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (userSnapshot.exists() && userSnapshot.val().apartmentId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const apartmentId = userSnapshot.val().apartmentId;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userNameFromDB = userSnapshot.val().userName;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("userNameFromDB (Realtime Database):", userNameFromDB);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('Apartment ID from DB (before storage):', apartmentId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('apartmentId', apartmentId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('userName', userNameFromDB);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("apartmentId nÃ£o encontrado para o usuÃ¡rio:", user.uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mensagemLogin.textContent = 'Erro ao carregar informaÃ§Ãµes do seu apartamento. Tente novamente mais tarde.';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const errorCode = error.code;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const errorMessage = error.message;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("CÃ³digo de erro:", errorCode);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (errorCode === 'auth/invalid-email') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mensagemLogin.textContent = 'O email digitado Ã© invÃ¡lido.';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (errorCode === 'auth/invalid-credential') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mensagemLogin.innerHTML = 'E-mail e/ou senha incorretos.<br>Verifique se vocÃª digitou corretamente suas credenciais.<br>Se vocÃª esqueceu sua senha, use o link "Esqueci minha senha".';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mensagemLogin.textContent = 'Erro ao fazer login: ' + errorMessage;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  </script>
</head>
<body>
Â  Â  <header>
Â  Â  Â  Â  <img src="images/logo_cond.jpg" alt="Logo do CondomÃ­nio" class="logo">
Â  Â  </header>

Â  Â  <div class="image-column">
Â  Â  Â  Â  </div>

Â  Â  <div class="form-column">
Â  Â  Â  Â  <section id="login">
Â  Â  Â  Â  Â  Â  <h2>Login</h2>
Â  Â  Â  Â  Â  Â  <form id="formularioLogin">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="emailLogin">Email:</label><br>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="email" id="emailLogin" name="emailLogin" required style="width: 270px;"><br><br>
Â  Â  Â  Â  Â  Â  Â  Â  <label for="senhaLogin">Senha:</label><br>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" id="senhaLogin" name="senhaLogin" maxlength="6" inputmode="numeric"><br><br>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" style="margin-right: 10px;">Entrar</button><br><br>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="#" id="forgotPassword">Esqueci minha senha</a><br>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="mensagemLogin"></div>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  <p>NÃ£o tem uma conta? <a href="#" id="mostrarCadastro">Cadastre-se</a></p>
Â  Â  Â  Â  </section>

Â  Â  Â  Â  <section id="forgotPasswordSection" style="display:none;">
Â  Â  Â  Â  Â  Â  <h2>Recuperar Senha</h2>
Â  Â  Â  Â  Â  Â  <form id="forgotPasswordForm">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="emailForgotPassword">Email:</label><br><br>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="email" id="emailForgotPassword" name="emailForgotPassword" required><br><br>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit">Enviar link de recuperaÃ§Ã£o</button><br><br>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="mensagemForgotPassword"></div>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  <p><a href="#" id="mostrarLoginFromForgot">Voltar para o Login</a></p>
Â  Â  Â  Â  </section>

Â  Â  Â  Â  <section id="cadastro" style="display:none;">
Â  Â  Â  Â  Â  Â  <h2>Cadastro</h2>
Â  Â  Â  Â  Â  Â  <form id="formularioCadastro">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="emailCadastro">Email:</label><br>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="email" id="emailCadastro" name="emailCadastro" required><br><br>
Â  Â  Â  Â  Â  Â  Â  Â  <label for="senhaCadastro">Senha:</label><br>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" id="senhaCadastro" name="senhaCadastro" maxlength="6" inputmode="numeric"><br><br>
Â  Â  Â  Â  Â  Â  Â  Â  <label for="codigoAcesso">CÃ³digo de Acesso:</label><br>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="codigoAcesso" name="codigoAcesso" placeholder="Seu CÃ³digo de Acesso"><br><br>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit">Cadastrar</button>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="mensagemCadastro"></div>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  <p>JÃ¡ tem uma conta? <a href="#" id="mostrarLogin">FaÃ§a login</a></p>
Â  Â  Â  Â  </section>

Â  Â  </div>
Â  Â  <footer>
Â  Â  Â  Â  <p>&copy; 2025 Portal do CondomÃ­nio. Todos os direitos reservados.</p>
Â  Â  Â  Â  <p style="font-size: 0.8em; text-align: center;">U 301.</p>
Â  Â  </footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
Â  Â  const senhaCadastroInput = document.getElementById('senhaCadastro');
Â  Â  const senhaLoginInput = document.getElementById('senhaLogin');

Â  Â  if (senhaCadastroInput) {
Â  Â  Â  Â  senhaCadastroInput.addEventListener('input', function() {
Â  Â  Â  Â  Â  Â  this.value = this.value.replace(/[^0-9]/g, ''); // Remove nÃ£o numÃ©ricos
Â  Â  Â  Â  Â  Â  if (this.value.length > this.maxLength) {
Â  Â  Â  Â  Â  Â  Â  Â  this.value = this.value.slice(0, this.maxLength);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }

Â  Â  if (senhaLoginInput) {
Â  Â  Â  Â  senhaLoginInput.addEventListener('input', function() {
Â  Â  Â  Â  Â  Â  this.value = this.value.replace(/[^0-9]/g, ''); // Remove nÃ£o numÃ©ricos
Â  Â  Â  Â  Â  Â  if (this.value.length > this.maxLength) {
Â  Â  Â  Â  Â  Â  Â  Â  this.value = this.value.slice(0, this.maxLength);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }
});
</script>
<script src="script.js" defer type="module"></script>
</body>
</html>
